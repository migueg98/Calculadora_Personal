<!doctype html>
<html>
<head>
<meta charset="utf-8">
<title>Cuadrantes Hostelería — Demo</title>
<style>
body{font-family:system-ui,Segoe UI,Arial;margin:20px;max-width:900px}
textarea,input,button{font-size:14px;padding:8px;margin:6px 0;width:100%}
label{font-weight:600;margin-top:12px;display:block}
pre{background:#f5f5f5;padding:12px;white-space:pre-wrap}
.grid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.small{width:200px}
.row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
</style>
</head>
<body>
  <h1>Cuadrantes — Greedy</h1>
  <p>Introduce <b>slots</b> (uno por línea, HH:MM-HH:MM), <b>mínimos</b> (coma) y <b>empleados</b> (IDs por coma).</p>

  <div class="grid">
    <div>
      <label>Slots (uno por línea)</label>
      <textarea id="slots" rows="6">11:00-13:00
13:00-16:00
20:00-23:59</textarea>
    </div>
    <div>
      <label>Mínimos por slot (coma)</label>
      <input id="mins" value="3,4,3">
      <label>Empleados (IDs, coma)</label>
      <input id="emps" value="E1,E2,E3,E4,E5,E6">
      <div class="row">
        <div>
          <label>Objetivo horas</label>
          <input id="target" class="small" value="40">
        </div>
        <div>
          <label>Tolerancia ±h</label>
          <input id="tol" class="small" value="2">
        </div>
      </div>

      <hr>
      <h3>Reglas duras (v2)</h3>
      <div class="row">
        <div>
          <label>Día (v2)</label>
          <input id="day" class="small" value="Mon">
        </div>
        <div>
          <label>Max h/día</label>
          <input id="maxDay" class="small" value="10">
        </div>
        <div>
          <label>Max bloques/día</label>
          <input id="maxBlocks" class="small" value="2">
        </div>
      </div>
      <div class="row">
        <div>
          <label>Disponibilidad global (inicio)</label>
          <input id="availStart" class="small" value="11:00">
        </div>
        <div>
          <label>Disponibilidad global (fin)</label>
          <input id="availEnd" class="small" value="23:59">
        </div>
      </div>

      <button id="run">Calcular (simple)</button>
      <button id="runV2">Calcular (reglas duras)</button>
    </div>
  </div>

  <h3>Resultado</h3>
  <pre id="out"></pre>

<script>
function parseBasicInputs(){
  const slotsTxt = document.getElementById('slots').value.trim();
  const minsTxt = document.getElementById('mins').value.trim();
  const empsTxt = document.getElementById('emps').value.trim();
  const target = parseFloat(document.getElementById('target').value || '40');
  const tol = parseFloat(document.getElementById('tol').value || '2');

  const slots = slotsTxt.split(/\n+/).map(line => {
    const [s,e] = line.split('-').map(t => t.trim());
    return {start:s, end:e};
  });
  const mins = minsTxt.split(',').map(x => parseInt(x.trim(),10));
  const emps = empsTxt.split(',').map(id => ({id:id.trim(), target_hours: target}));
  return {slots, mins, emps, target, tol};
}

document.getElementById('run').onclick = async () => {
  const {slots, mins, emps, tol} = parseBasicInputs();
  const payload = { slots, min_per_slot: mins, employees: emps, tolerance: tol };
  const res = await fetch('/solve/greedy', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  document.getElementById('out').textContent = JSON.stringify(data, null, 2);
};

document.getElementById('runV2').onclick = async () => {
  const {slots, mins, emps, target, tol} = parseBasicInputs();
  const day = document.getElementById('day').value.trim() || 'Mon';
  const maxDay = parseFloat(document.getElementById('maxDay').value || '10');
  const maxBlocks = parseInt(document.getElementById('maxBlocks').value || '2', 10);
  const availStart = document.getElementById('availStart').value.trim() || '11:00';
  const availEnd = document.getElementById('availEnd').value.trim() || '23:59';

  // Adaptar slots con día
  const slotsV2 = slots.map(s => ({ day, start: s.start, end: s.end }));

  // Disponibilidad global (mismo rango para todos en 'day')
  const employeesV2 = emps.map(e => ({
    id: e.id,
    target_hours: target,
    max_hours_per_day: maxDay,
    max_blocks_per_day: maxBlocks,
    availability: { [day]: [{ start: availStart, end: availEnd }] }
  }));

  const payload = { slots: slotsV2, min_per_slot: mins, employees: employeesV2, tolerance: tol };

  const res = await fetch('/solve/greedy_v2', {
    method:'POST', headers:{'Content-Type':'application/json'},
    body: JSON.stringify(payload)
  });
  const data = await res.json();
  document.getElementById('out').textContent = JSON.stringify(data, null, 2);
};
</script>
</body>
</html>
